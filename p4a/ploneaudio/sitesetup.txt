Site Setup
==========

The ``sitesetup`` module contains logic for configuring a Zope 3
``ISite`` and Plone portal instance.

Configuring an ISite
--------------------

    >>> from p4a.audio import interfaces
    >>> from p4a.common.testing import MockSite
    >>> from p4a.ploneaudio import sitesetup

First we make sure a fresh site has no ``IAudioSupport`` utility registered.

    >>> site = MockSite()
    >>> site.queryUtility(interfaces.IAudioSupport) is None
    True

Once we've run the ``setup_site`` function call, the site now has the
appropriate utilities registered.

    >>> sitesetup.setup_site(site)
    >>> site.queryUtility(interfaces.IAudioSupport)
    <AudioSupport ...>

Putting It Altogether
---------------------

Now that all of the individual functions have been explored, the last
step is to simply run the ``setup_portal`` function which runs all the
previous functions plus uses the quick installer to install CMFonFive.

    >>> class MockInstaller:
    ...     products = []
    ...     def installProducts(self, prods): self.products.extend(prods)
    >>> installer = site.portal_quickinstaller = MockInstaller()
    >>> installer.products
    []
    >>> sitesetup.setup_portal(site)
    >>> installer.products
    ['CMFonFive']

And of course the _cleanup_utilities is a placeholder which doesn't do anything
but raise an exception at this point.

    >>> sitesetup._cleanup_utilities(site)
    Traceback (most recent call last):
      ...
    NotImplementedError...

And we also have the ``unsetup_portal`` function.  So lets see how that
runs as well.

    >>> sitesetup.unsetup_portal(site)
